"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue-click-outside"),d=require("vue"),h=require("../../utils/utils.cjs.js"),c=require("../../composables/useTabKeyHandler.cjs.js"),u=require("../BaseIcon/BaseIcon.vue.cjs.js"),b=require("../../mixins/popUpLock.cjs.js");require("./BaseTooltipBox.vue.cjs2.js");const p=require("../../_virtual/_plugin-vue2_normalizer.cjs.js"),f={name:"BaseTooltipBox",components:{BaseIcon:u.default},directives:{ClickOutside:a},mixins:[b.default],props:{attachTo:{type:null,required:!0},directionOrder:{type:Array,default:()=>["top","bottom","right","left"],validator:e=>[...e].sort().toString()===["top","bottom","right","left"].sort().toString()},styles:{type:Object,default:()=>({})},modalTitle:{type:String,default:""},typeOnMobile:{type:String,default:"modal",validator:e=>["box","fullscreen","modal"].includes(e)},thresholdTop:{type:Number,default:0},headerId:{type:[String,Number],default:"popup-title"},descriptionElementId:{type:String,default:"popup-body"},overlayBackgroundVisible:{type:Boolean,default:!1},mobileSize:{type:Number,default:640},initialFocusElement:{type:String,default:""},focusableElements:{type:Array,default:()=>["a[href]","button:enabled","input:enabled",'*[tabindex]:not([tabindex="-1"])']},disableTabKeyHandler:{type:Boolean,default:!1}},setup(e){const t=`base-tooltip-box-${h.createId()}`,i=d.ref(null),{focusableHTMLTags:s,disableHandler:o}=c.useTabKeyHandler(i,e.focusableElements.join(", "),e.disableTabKeyHandler);return d.watchEffect(()=>{s.value=e.focusableElements,o.value=e.disableTabKeyHandler}),{internalId:t,popUpBody:i}},data(){return{isActive:!1,direction:null,css:{top:"0",left:"-10000px"},thresholdX:2,thresholdY:2,spacing:8,bodyHeight:null,bodyInnerHeight:null,fadeOutTop:!1,fadeOutBottom:!1,resizeObserver:null,mutationObserver:null,isClickOutsideActive:!1,targetName:"popUpBody",showInt:!1,prevActiveElement:void 0}},computed:{isScrollable(){return this.bodyInnerHeight>this.bodyHeight},getThresholdTop(){const t=getComputedStyle(document.body).getPropertyValue("--base-tooltip-box-threshold-top");if(!t)return this.thresholdTop;if(/^\d+$/.test(t))return Number(t);const i=document.createElement("div");i.style.position="absolute",i.style.top=t,i.style.visibility="hidden",document.body.appendChild(i);const s=window.getComputedStyle(i).top,o=Number(s.replace(/\D/g,""));return i.remove(),o}},watch:{attachTo(){this.$nextTick(()=>{this.calcContentHeight(),this.calcFadeOuts(),this.calcPosition()})}},mounted(){this.prevActiveElement=document==null?void 0:document.activeElement,document.querySelector("body").appendChild(this.$el),setTimeout(()=>{this.isClickOutsideActive=!0},0),setTimeout(()=>{this.calcPosition(),this.isActive=!0,this.showInt=this.isPopUpLockEnabled(),this.initObserver(),this.focusInitialElement(),this.$refs.body.addEventListener("scroll",this.scrollHandler),window.addEventListener("resize",this.resizeHandler),window.addEventListener("keyup",this.escEventHandler)},0)},beforeDestroy(){this.isActive=!1,this.showInt=!1,this.prevActiveElement&&JSON.stringify(this.prevActiveElement.classList)!==JSON.stringify(document.activeElement.classList)&&this.prevActiveElement.focus(),this.resizeObserver&&this.resizeObserver.unobserve(this.$refs.bodyInner),this.mutationObserver&&this.mutationObserver.disconnect(),this.$refs.body.removeEventListener("scroll",this.scrollHandler),window.removeEventListener("resize",this.resizeHandler),window.removeEventListener("keyup",this.escEventHandler)},methods:{isPopUpLockEnabled(){return(this.typeOnMobile==="modal"||this.typeOnMobile==="fullscreen")&&window.innerWidth<640},calcContentHeight(){!this.$refs.body||!this.$refs.bodyInner||(this.bodyHeight=Math.ceil(this.$refs.body.getBoundingClientRect().height),this.bodyInnerHeight=Math.ceil(this.$refs.bodyInner.getBoundingClientRect().height))},calcPosition(){this.css={};const e=this.attachTo.getBoundingClientRect(),t=this.$el,i=t.offsetWidth,s=t.offsetHeight,o=parseFloat(window.getComputedStyle(t,":after").height)/2,l=parseFloat(window.getComputedStyle(t,":after").width)/2,{scrollY:n}=window;if(this.directionOrder.every(r=>r==="left"&&e.left>i+l&&!(e.top+e.height/2-this.getThresholdTop<s/2)&&!(window.innerHeight-(e.top+e.height/2)<s/2)?(this.direction="left",this.css.top=`${e.top+e.height/2-s/2+n}px`,this.css.left=`${e.left-i-l-this.thresholdX}px`,!1):r==="right"&&window.innerWidth-e.right>i+l&&!(e.top+e.height/2-this.getThresholdTop<s/2)&&!(window.innerHeight-(e.top+e.height/2)<s/2)?(this.direction="right",this.css.top=`${e.top+e.height/2-s/2+n}px`,this.css.left=`${e.right+l+this.thresholdX}px`,!1):r==="top"&&e.top-this.getThresholdTop>s+o+this.thresholdY?(this.direction="top",this.css.top=`${e.top-s-o-this.thresholdY+n}px`,this.css.left=`${e.left+e.width/2-i/2}px`,!1):r==="bottom"&&window.innerHeight-e.bottom>s+o+this.thresholdY+this.spacing?(this.direction="bottom",this.css.top=`${e.bottom+o+this.thresholdY+n}px`,this.css.left=`${e.left+e.width/2-i/2}px`,!1):!0),this.css["--triangle-left"]="50%",!!["top","bottom"].includes(this.direction)){if(e.x<i/2){this.css.left=`${this.spacing}px`,this.css.right="",this.css["--triangle-left"]=`${e.left+e.width/2-this.spacing}px`;return}e.left+e.width/2+i/2>window.innerWidth&&(this.css.left="",this.css.right=`${this.spacing}px`,this.css["--triangle-left"]=`${i+this.spacing-(document.body.clientWidth-(e.right-e.width/2))}px`)}},calcFadeOuts(){if(!this.isScrollable||!this.$refs.body)return;const{scrollTop:e}=this.$refs.body;this.fadeOutTop=e>=1,this.fadeOutBottom=!(e+this.bodyHeight>=this.bodyInnerHeight)},close(){this.$emit("close")},clickedOutside(){this.isClickOutsideActive&&this.close()},initObserver(){const e=new ResizeObserver(()=>{this.calcContentHeight(),this.calcFadeOuts()}),t=new MutationObserver(()=>{this.calcContentHeight(),this.calcFadeOuts(),this.calcPosition()});e.observe(this.$refs.bodyInner),t.observe(this.$refs.bodyInner,{childList:!0,subtree:!0}),this.resizeObserver=e,this.mutationObserver=t},focusInitialElement(){setTimeout(()=>{const e=this.$el.id;let t=e?document==null?void 0:document.getElementById(e):void 0;this.typeOnMobile!=="box"&&this.isMobile()&&(t=this.headerId?this.$el.querySelector(`#${this.headerId}`):void 0),this.initialFocusElement&&this.$el.querySelector(this.initialFocusElement)&&(t=this.$el.querySelector(this.initialFocusElement)),t&&t.focus()},0)},resizeHandler(){this.calcPosition()},scrollHandler(){this.calcFadeOuts()},escEventHandler(e){e.key==="Escape"&&this.close()},isMobile(){return(window==null?void 0:window.innerWidth)<=this.mobileSize}}};var m=function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:()=>t.clickedOutside(),expression:"() => clickedOutside()"}],ref:"popUpBody",class:["base-tooltip-box",{"base-tooltip-box--background-visible":t.overlayBackgroundVisible},"base-tooltip-box--"+t.direction,{"base-tooltip-box--modal-on-mobile":t.typeOnMobile==="modal"||t.typeOnMobile==="fullscreen"},{"base-tooltip-box--fullscreen-on-mobile":t.typeOnMobile==="fullscreen"},{"base-tooltip-box--active":t.isActive}],style:{...t.styles,...t.css},attrs:{id:t.internalId,role:"dialog",tabindex:"-1","aria-labelledby":t.headerId,"aria-describedby":t.descriptionElementId}},[i("div",{staticClass:"base-tooltip-box__inner",attrs:{id:t.descriptionElementId}},[i("div",{staticClass:"base-tooltip-box__header"},[t._t("header-title",function(){return[i("div",{staticClass:"base-tooltip-box__header__title",attrs:{id:t.headerId,tabindex:"-1"}},[t._v(" "+t._s(t.modalTitle)+" ")])]},{headerId:t.headerId}),i("button",{staticClass:"base-tooltip-box__button",attrs:{title:"close"},on:{click:t.close}},[i("BaseIcon",{staticClass:"base-tooltip-box__button__icon",attrs:{name:"remove"}})],1)],2),i("div",{ref:"body",class:["base-tooltip-box__body",{"base-tooltip-box__body--fade-out":t.fadeOutTop||t.fadeOutBottom},{"base-tooltip-box__body--fade-out--top":t.fadeOutTop},{"base-tooltip-box__body--fade-out--bottom":t.fadeOutBottom}]},[i("div",{ref:"bodyInner",staticClass:"base-tooltip-box__body__inner"},[t._t("default",function(){return[i("i",[t._v("use default slot")])]})],2)])])])},y=[],g=p.default(f,m,y,!1,null,"12e91bf4",null,null);const v=g.exports;exports.default=v;
//# sourceMappingURL=BaseTooltipBox.vue.cjs.js.map
