"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const c=require("../BaseFormFieldCreator/BaseFormFieldCreator.vue.cjs.js"),p=require("../../mixins/i18n.cjs.js");require("./BaseForm.vue.cjs2.js");require("./BaseForm.vue.cjs3.js");const h=require("../../_virtual/_plugin-vue2_normalizer.cjs.js"),_=["errorMessage","invalid","isActive","isLoading","linkedListOption","activeTab","validationTexts"],g={name:"BaseForm",components:{BaseButton:()=>Promise.resolve().then(()=>require("../BaseButton/BaseButton.vue.cjs.js")).then(t=>t.default||t),BaseIcon:()=>Promise.resolve().then(()=>require("../BaseIcon/BaseIcon.vue.cjs.js")).then(t=>t.default||t),BaseFormFieldCreator:c.default},mixins:[p.default],props:{formFieldJson:{type:Object,required:!0},valueList:{type:Object,default:()=>({})},language:{type:String,default:"en"},availableLocales:{type:Array,default:()=>[]},formId:{type:String,default:""},formStyle:{type:Object,default:()=>({})},fieldsWithTabs:{type:Array,default:()=>[]},fieldIsLoading:{type:String,default:""},dropDownLists:{type:Object,default:()=>({})},showErrorIcon:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},fieldProps:{type:Object,default:()=>({}),validator:t=>Object.keys(t).length===0||Object.values(t).every(e=>Object.keys(e))},renderHeaderAs:{type:String,default:"div"},validationTexts:{type:Object,default:()=>({text:{min:"Value must be greater than or equal to {value}.",max:"Value must be less than or equal to {value}.",minLength:"Text must be at least {value} character(s) long.",maxLength:"Text cannot be longer than {value} characters."},chips:{required:"Select an option."}}),validator:t=>["text"].every(e=>Object.keys(t).includes(e))&&["min","max","minLength","maxLength"].every(e=>Object.keys(t.text).includes(e))},identifierPropertyName:{type:String,default:"source"},labelPropertyName:{type:String,default:"label"},assistiveText:{type:Object,default:()=>({loaderActive:"loading.",resultsRetrieved:"{number} options in drop down.",optionAdded:"option {label} added to selected list.",optionToRemoveSelected:"option {label} from selected list marked for removal. Press delete or backspace to remove.",optionRemoved:"option {label} removed."})}},data(){return{multiplyParams:null,fetchingAutocompleteFor:"",valueListInt:{}}},computed:{cleanedAndSortedFormFieldList(){return Object.entries(this.formFieldJson).filter(([,t])=>{var e;return!t.$ref&&!((e=t["x-attrs"])!=null&&e.hidden)}).map(([t,e])=>({name:t,...e})).sort((t,e)=>{var i,a;return((i=t["x-attrs"])==null?void 0:i.order)>((a=e["x-attrs"])==null?void 0:a.order)?1:-1})},formFieldListInt(){return this.cleanedAndSortedFormFieldList.reduce((t,e)=>{var u,s;const{field_format:i,order:a,field_type:l}=e["x-attrs"],n=t.length-1;return i&&l!=="group"&&["half","third"].includes(i)&&t[n]&&((u=t[n])==null?void 0:u.type)===i&&(i==="half"&&t[n].data.length<2||i==="third"&&t[n].data.length<3)&&t[n].data.at(-1)["x-attrs"].order+1>=a?t[n].data.push(e):t.push({type:i&&((s=e["x-attrs"])==null?void 0:s.field_type)!=="group"?i:"full",data:[e]}),t},[])},formHeader(){const t=this.cleanedAndSortedFormFieldList.find(e=>e["x-attrs"]&&e["x-attrs"].form_group_title);return t?t["x-attrs"].form_group_title:""}},watch:{valueList:{handler(t){Object.keys(this.valueListInt).some(i=>JSON.stringify(this.valueListInt[i])!==JSON.stringify(t[i]))&&this.initializeValueObject()},deep:!0},formFieldJson:{handler(){this.valueListInt={},this.initializeValueObject()},immediate:!0}},updated(){if(this.multiplyParams&&this.multiplyParams.name){const t=this.$refs[this.multiplyParams.name];t.length&&setTimeout(e=>{const i=t[e.index].getElementsByTagName("textarea").length?t[e.index].getElementsByTagName("textarea"):t[e.index].getElementsByTagName("input");i.length&&i[0].focus()},50,this.multiplyParams),this.multiplyParams=null}},mounted(){this.$nextTick(()=>{this.$emit("form-mounted")})},methods:{fetchAutocomplete(t){this.fetchingAutocompleteFor=t.name,this.$emit("fetch-autocomplete",t)},onInputComplete(t,e,i=-1){this.setFieldValue(t,e,i),this.$emit("input-complete",this.valueListInt)},setFieldValue(t,e,i=-1){i>=0?this.$set(this.valueListInt[e],i,JSON.parse(JSON.stringify(t))):this.$set(this.valueListInt,e,t&&JSON.parse(JSON.stringify(t))),this.propagateValueListChanges()},propagateValueListChanges(){this.$emit("values-changed",this.valueListInt)},initializeValueObject(){this.cleanedAndSortedFormFieldList.forEach(t=>{this.$set(this.valueListInt,t.name,this.getInitialFieldValue(t))})},getInitialFieldValue({name:t,"x-attrs":e,type:i,items:a,properties:l}){const n=this.valueList[t],u=e==null?void 0:e.field_type;if(["number","integer"].includes(i))return n||"";if(u&&u.includes("chips")&&i==="object")return n&&Object.keys(n).length?[].concat(n):[];if(i==="array")return typeof n=="object"&&n&&n.length?[].concat(n):!e||!u||u&&!u.includes("chips")?[].concat(this.getInitialFieldValue(a)):[];if(i==="object"){const s={};return Object.keys(l).forEach(r=>{this.$set(s,r,this.getInitialFieldValue(l[r]))}),{...s,...n}}return i==="boolean"?n||!1:typeof n=="string"?n:""},multiplyField(t,e){const i=this.getInitialFieldValue(t.items);!e&&e!==0?this.valueListInt[t.name].push(i):this.valueListInt[t.name].splice(e+1,0,i),this.multiplyParams={index:!e&&e!==0?this.valueListInt[t.name].length-1:e+1,name:t.name},this.propagateValueListChanges()},removeField(t,e){const i=this.valueListInt[t.name];i&&i.length>1?i.splice(e,1):this.$set(i,e,this.getInitialFieldValue(t.items)),this.propagateValueListChanges(),this.$emit("input-complete",this.valueListInt)},validate(){const t=[];return this.$refs.baseFormField.forEach(i=>{if(Object.keys(i.$refs).length){const a=Object.keys(i.$refs)[0];if(i.$refs[a].validate!==void 0){const l=i.$refs[a].validate();l&&t.push(l)}}}),!!t.length},formFieldComponentProps(t,e,i,a=-1){const{name:l}=t;let n=this.fieldProps[l]?JSON.parse(JSON.stringify(this.fieldProps[l])):{};const u=a>=0;if(u){const r=Object.entries(n).filter(([o])=>_.includes(o));if(r.length){const o=r.reduce((f,[d,m])=>Object.keys(m).includes(a.toString())?{...f,[d]:m[a.toString()]}:(delete n[d],f),{});n={...n,...o}}}const s=u?`${e}_${i}_${a}`:`${e}_${i}`;return{field:t,label:n&&n.label?n.label:this.getFieldName(t),fieldProps:n,showLabel:!this.allowMultiply(t)||!this.multiplyButtonsInline(t)||a===0,dropDownList:this.dropDownLists[l],secondaryDropdown:this.dropDownLists[`${l}_secondary`],language:this.language,availableLocales:this.availableLocales,sortText:this.getI18nTerm("form.sort")||"Sort",fieldKey:`${l}_${s}_${this.formId}`,fieldValue:u?this.valueListInt[l][a]:this.valueListInt[l],autocompleteLoading:this.fieldIsLoading===l,fieldGroupParams:this.cleanedAndSortedFormFieldList.some(r=>r["x-attrs"]&&r["x-attrs"].field_type==="group")?this.$props:null,clearable:this.clearable,showErrorIcon:this.showErrorIcon,validationTexts:n.validationTexts||this.validationTexts,identifierPropertyName:this.identifierPropertyName,labelPropertyName:this.labelPropertyName,assistiveText:n.assistiveText||this.assistiveText}},allowMultiply(t){return t.type==="array"&&(!t["x-attrs"]||!t["x-attrs"].field_type||t["x-attrs"]&&!["chips","chips-below"].includes(t["x-attrs"].field_type))},multiplyButtonsInline(t){return!["group","multiline"].includes(t["x-attrs"].field_type)},fieldIsDateSwitch(t){var e,i;return((e=t==null?void 0:t.field_type)==null?void 0:e.includes("date"))&&((i=t==null?void 0:t.date_format)==null?void 0:i.includes("_"))},getFieldName(t){return t.title||this.getI18nTerm(`form.${t.name}`||t.name)},checkFieldContent(t,e=-1){return this.hasValues(e<0?this.valueListInt[t][e]:this.valueListInt[t])},hasValues(t){let e=!1;return t&&typeof t=="object"?t.length>=0?t.forEach(i=>{e=this.hasValues(i)||e}):Object.keys(t).forEach(a=>{e=this.hasValues(t[a])||e}):e=t===0||!!t||e,e}}};var y=function(){var e=this,i=e._self._c;return i("div",{staticClass:"base-form",style:e.formStyle},[e.formHeader?i(e.renderHeaderAs,{tag:"component",staticClass:"base-form__header"},[e._v(" "+e._s(e.formHeader)+" ")]):e._e(),i("div",{staticClass:"base-form__body"},e._l(e.formFieldListInt,function(a,l){return i("div",{key:`form-row-${e.formId}-${l}`,class:["base-form__form-row",`base-form__form-row--${a.type}`]},[e._l(a.data,function(n,u){return[e.allowMultiply(n)?e.allowMultiply(n)?i("div",{key:`${n.name}_${u}_${e.formId}_wrapper`,class:["base-form__input-field",`base-form__input-field--${a.type}`,{"base-form__input-field--date-switch-spacing":e.fieldIsDateSwitch(n["x-attrs"])}]},e._l(e.valueListInt[n.name],function(s,r){return i("div",{key:`${n.name}_${u}_${r}_${e.formId}_wrapper`,ref:n.name,refInFor:!0,class:[{"base-form__repeatable-field":e.multiplyButtonsInline(n)}]},[i("BaseFormFieldCreator",e._b({key:`${n.name}_${u}_${r}_${e.formId}`,ref:"baseFormField",refInFor:!0,class:["base-form__input-component",{"base-form__input-component--margin-bottom":!e.multiplyButtonsInline(n)}],on:{"field-value-changed":function(o){return e.setFieldValue(o,n.name,r)},"fetch-autocomplete":e.fetchAutocomplete,"input-complete":function(o){return e.onInputComplete(o,n.name,r)}},scopedSlots:e._u([{key:"label-addition",fn:function({fieldName:o,groupNames:f}){return[e._t("label-addition",null,{fieldName:o,groupNames:f,index:r})]}},{key:"pre-input-field",fn:function({fieldName:o,groupNames:f}){return[e._t("pre-input-field",null,{fieldName:o,groupNames:f,index:r})]}},{key:"input-field-addition-before",fn:function({fieldName:o,groupNames:f}){return[e._t("input-field-addition-before",null,{fieldName:o,groupNames:f,index:r})]}},{key:"input-field-inline-before",fn:function({fieldName:o,groupNames:f}){return[a["x-attrs"]&&a["x-attrs"].text_before?i("span",{staticClass:"base-form__input-field__text-before"},[e._v(" "+e._s(a["x-attrs"].text_before)+" ")]):e._e(),e._t("input-field-inline-before",null,{fieldName:o,groupNames:f,index:r})]}},{key:"input-field-addition-after",fn:function({fieldName:o,groupNames:f}){return[a["x-attrs"]&&a["x-attrs"].text_after?i("span",{staticClass:"base-form__input-field__text-after"},[e._v(" "+e._s(a["x-attrs"].text_after)+" ")]):e._e(),e._t("input-field-addition-after",null,{fieldName:o,groupNames:f,index:r})]}},{key:"post-input-field",fn:function({fieldName:o,groupNames:f}){return[e._t("post-input-field",null,{fieldName:o,groupNames:f,index:r})]}},{key:"error-icon",fn:function(){return[e._t("error-icon")]},proxy:!0},{key:"remove-icon",fn:function(){return[e._t("remove-icon")]},proxy:!0},{key:"below-input",fn:function({fieldName:o,groupNames:f}){return[e._t("below-input",null,{fieldName:o,groupNames:f,index:r})]}},{key:"drop-down-entry",fn:function({option:o,fieldName:f,groupNames:d}){return[e._t("drop-down-entry",null,{fieldName:f,groupNames:d,option:o})]}}],null,!0)},"BaseFormFieldCreator",e.formFieldComponentProps(n,u,l,r),!1)),e.multiplyButtonsInline(n)?[i("div",{ref:"multiplyButtons",refInFor:!0,staticClass:"base-form__inline-buttons"},[e.valueListInt[n.name].length>1||e.checkFieldContent(n.name,0)?i("BaseButton",{staticClass:"base-form__inline-button",attrs:{"icon-title":e.valueListInt[n.name].length===1?e.getI18nTerm("form.clearField")||"Clear":e.getI18nTerm("form.removeField",-1,{fieldType:e.getFieldName(a)}),"has-background-color":!1,text:"","button-style":"single",icon:"remove","icon-size":"large"},on:{clicked:function(o){return e.removeField(n,r)}}}):e._e(),i("BaseButton",{staticClass:"base-form__inline-button",attrs:{"icon-title":r!==e.valueListInt[n.name].length-1?e.getI18nTerm("form.addGroupBelow",-1,{fieldType:e.getFieldName(n)}):e.getI18nTerm("form.addGroup",-1,{fieldType:e.getFieldName(n)}),"has-background-color":!1,text:"","button-style":"single",icon:"plus","icon-size":"large"},on:{clicked:function(o){return e.multiplyField(n,r)}}})],1)]:e._e(),i("div",{staticClass:"base-form__multiply-buttons"},[!e.multiplyButtonsInline(n)&&(e.valueListInt[n.name].length>1||e.checkFieldContent(n.name,0))?i("BaseButton",{class:["base-form__multiply-button","base-form__multiply-button--remove"],attrs:{text:e.valueListInt[n.name].length===1?e.getI18nTerm("form.clearField")||"Clear":e.getI18nTerm("form.removeField",-1,{fieldType:e.getFieldName(n)}),"has-background-color":!1,"icon-position":"right",icon:"remove"},on:{clicked:function(o){return e.removeField(n,r)}}}):e._e(),e.multiplyButtonsInline(n)?e._e():i("BaseButton",{staticClass:"base-form__multiply-button",attrs:{text:e.getI18nTerm("form.addGroup",-1,{fieldType:e.getFieldName(n)}),"has-background-color":!1,"icon-position":"right",icon:"plus"},on:{clicked:function(o){return e.multiplyField(n,r)}}})],1)],2)}),0):e._e():i("BaseFormFieldCreator",e._b({key:`${n.name}_${l}_${u}_${e.formId}`,ref:"baseFormField",refInFor:!0,class:["base-form__input-field",`base-form__input-field--${a.type}`,{"base-form__input-field--top-margin":n.type==="boolean"},{"base-form__input-field--date-switch-spacing":e.fieldIsDateSwitch(n["x-attrs"])}],on:{"field-value-changed":function(s){return e.setFieldValue(s,n.name)},"fetch-autocomplete":e.fetchAutocomplete,"input-complete":function(s){return e.onInputComplete(s,n.name)}},scopedSlots:e._u([{key:"label-addition",fn:function({fieldName:s,groupNames:r}){return[e._t("label-addition",null,{fieldName:s,groupNames:r})]}},{key:"pre-input-field",fn:function({fieldName:s,groupNames:r}){return[e._t("pre-input-field",null,{fieldName:s,groupNames:r})]}},{key:"input-field-addition-before",fn:function({fieldName:s,groupNames:r}){return[e._t("input-field-addition-before",null,{fieldName:s,groupNames:r})]}},{key:"input-field-inline-before",fn:function({fieldName:s,groupNames:r}){return[e._t("input-field-inline-before",null,{fieldName:s,groupNames:r}),a["x-attrs"]&&a["x-attrs"].text_before?i("span",{staticClass:"base-form__input-field__text-before"},[e._v(" "+e._s(a["x-attrs"].text_before)+" ")]):e._e()]}},{key:"input-field-addition-after",fn:function({fieldName:s,groupNames:r}){return[a["x-attrs"]&&a["x-attrs"].text_after?i("span",{staticClass:"base-form__input-field__text-after"},[e._v(" "+e._s(a["x-attrs"].text_after)+" ")]):e._e(),e._t("input-field-addition-after",null,{fieldName:s,groupNames:r})]}},{key:"post-input-field",fn:function({fieldName:s,groupNames:r}){return[e._t("post-input-field",null,{fieldName:s,groupNames:r})]}},{key:"error-icon",fn:function(){return[e._t("error-icon")]},proxy:!0},{key:"remove-icon",fn:function(){return[e._t("remove-icon")]},proxy:!0},{key:"below-input",fn:function({fieldName:s,groupNames:r}){return[e._t("below-input",null,{fieldName:s,groupNames:r})]}},{key:"drop-down-entry",fn:function({option:s,fieldName:r,groupNames:o}){return[e._t("drop-down-entry",null,{fieldName:r,groupNames:o,option:s})]}}],null,!0)},"BaseFormFieldCreator",e.formFieldComponentProps(n,u,l),!1))]})],2)}),0)],1)},b=[],F=h.default(g,y,b,!1,null,"3d6211f9",null,null);const v=F.exports;exports.default=v;
//# sourceMappingURL=BaseForm.vue.cjs.js.map
