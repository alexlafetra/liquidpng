"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("../../utils/utils.cjs.js"),l=require("../../directives/InsertTextAsHtml.cjs.js"),o=require("../BaseIcon/BaseIcon.vue.cjs.js"),r=require("vue"),a=require("../../composables/useAnnouncer.cjs.js"),p=require("../BaseChipsInputField/BaseChipsInputField.vue.cjs.js"),u=require("../../mixins/i18n.cjs.js"),d=require("../../mixins/navigateList.cjs.js");require("./BaseChipsInput.vue.cjs2.js");const c=require("../../_virtual/_plugin-vue2_normalizer.cjs.js"),h={name:"BaseChipsInput",components:{BaseIcon:o.default,BaseDropDownList:()=>Promise.resolve().then(()=>require("../BaseDropDownList/BaseDropDownList.vue.cjs.js")).then(t=>t.default||t),BaseChipsInputField:p.default},directives:{insertTextAsHtml:l.default},mixins:[u.default,d.default],model:{prop:"selectedList",event:"selected-changed"},props:{list:{type:Array,default:()=>[]},selectedList:{type:Array,default:()=>[]},inputType:{type:String,default:"text",validator:t=>["text","search"].includes(t)},label:{type:String,required:!0},showLabel:{type:Boolean,default:!0},placeholder:{type:String,default:null},dropDownNoOptionsInfo:{type:String,default:"No options available"},allowUnknownEntries:{type:Boolean,default:!1},allowMultipleEntries:{type:Boolean,default:!0},allowDynamicDropDownEntries:{type:Boolean,default:!1},addSelectedEntryDirectly:{type:Boolean,default:!0},showInputBorder:{type:Boolean,default:!0},sortable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},alwaysLinked:{type:Boolean,default:!1},hoverboxContent:{type:Object,default:()=>({})},isLoading:{type:Boolean,default:!1},sortText:{type:String,default:"Sort A â€“ Z"},sortName:{type:Boolean,default:!1},language:{type:String,default:""},addNewChipText:{type:String,default:""},id:{type:String,default:""},identifierPropertyName:{type:String,default:"id"},labelPropertyName:{type:String,default:"label"},displayChipsInline:{type:Boolean,default:!0},required:{type:Boolean,default:!1},invalid:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},errorMessage:{type:String,default:""},showErrorIcon:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},inputClass:{type:String,default:""},chipsEditable:{type:Boolean,default:!1},closeDropdownOnOptionSelect:{type:Boolean,default:!1},assistiveText:{type:Object,default:()=>({selectedOption:"",loaderActive:"loading.",resultsRetrieved:"{number} options in drop down.",optionAdded:"option {label} added to selected list.",optionToRemoveSelected:"option {label} from selected list marked for removal. Press delete or backspace to remove.",optionRemoved:"option {label} removed."})},chipsRemovable:{type:Boolean,default:!0},defaultEntry:{type:[Object,null],default:null},highlightStringMatch:{type:Boolean,default:!1},highlightStringTags:{type:Array,default:()=>[]},interpretChipsLabelAsHtml:{type:Boolean,default:!1}},setup(){const t=r.ref(null),{announcement:e}=a.useAnnouncer(t);return{chipsInput:t,announcement:e}},data(){return{input:"",selectedListInt:[],activeOptionIndex:0,selectedOption:null,chipsInputActive:!1,dropDownMinWidth:"100%",inputElem:null,timeout:null}},computed:{chipsFieldInputProps(){const t={...this.$props,id:this.internalId};return delete t.dropDownNoOptionsInfo,delete t.allowDynamicDropDownEntries,delete t.addNewChipText,delete t.list,t},listInt(){let t=[...this.list];return this.allowUnknownEntries&&this.input&&t.unshift({[this.labelPropertyName]:this.language?{[this.language]:this.input}:this.input,[this.identifierPropertyName]:"createNew"}),this.selectedListInt&&this.selectedListInt.length&&(t=t.filter(e=>!this.selectedListInt.map(n=>n[this.identifierPropertyName]||n[this.labelPropertyName]).includes(e[this.identifierPropertyName]||e[this.labelPropertyName]))),this.input&&!this.allowDynamicDropDownEntries?t.filter(e=>this.getLangLabel(e[this.labelPropertyName]).toLowerCase().includes(this.input.toLowerCase())):t},activeOption:{set(t){this.activeOptionIndex=this.listInt.indexOf(t)},get(){return this.listInt[this.activeOptionIndex]}},internalId(){return this.id||s.createId()},highlightTags(){var t;return(t=this.highlightStringTags)!=null&&t.length?{highlightTags:this.highlightStringTags}:{}}},watch:{selectedOption(t){t&&(this.addSelectedOption(t),this.inputElem&&this.allowMultipleEntries&&this.inputElem.focus())},listInt:{handler(t){t.length&&!this.activeOption?this.activeOptionIndex=0:!t.length&&(!this.allowUnknownEntries||!this.input)&&(this.activeOptionIndex=-1),this.chipsInputActive&&!this.isLoading&&!this.announcement&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(()=>{this.chipsInputActive&&this.assistiveText.resultsRetrieved&&(t.length?this.announcement=this.assistiveText.resultsRetrieved.replace("{number}",t.length):this.announcement=this.dropDownNoOptionsInfo)},300))},immediate:!0},list:{handler(t){this.activeOptionIndex=t.length||this.allowUnknownEntries&&this.input?0:-1},immediate:!0},selectedList:{handler(t){this.selectedListInt=[...t]},immediate:!0},selectedListInt(t){JSON.stringify(t)!==JSON.stringify(this.selectedList)&&this.updateParentSelectedList(t)},input(t){this.allowDynamicDropDownEntries&&this.$emit("fetch-dropdown-entries",{value:t,type:this.labelPropertyName})},chipsInputActive(t){t&&!this.allowDynamicDropDownEntries&&!this.listInt.length&&this.$emit("fetch-dropdown-entries",{value:this.input,type:this.labelPropertyName}),t&&(this.calcDropDownMinWidth(),this.activeOptionIndex=0)}},mounted(){const t=this.$el.getElementsByTagName("input");t&&t.length&&([this.inputElem]=t),this.defaultEntry&&!this.selectedList.length&&this.selectedListInt.push(this.defaultEntry)},methods:{addSelectedOption(t){const e={...t};this.allowUnknownEntries&&e[this.identifierPropertyName]==="createNew"&&delete e[this.identifierPropertyName],this.allowMultipleEntries?this.selectedListInt.push(e):(this.$set(this.selectedListInt,0,e),this.chipsInputActive=!1),this.updateParentSelectedList(this.selectedListInt),this.assistiveText.optionAdded&&(this.announcement=this.assistiveText.optionAdded.replace("{label}",e[this.labelPropertyName])),this.input="",this.selectedOption=null,this.allowMultipleEntries||(this.chipsInputActive=!1,this.inputElem.blur()),setTimeout(()=>{this.closeDropDown()},0)},updateParentSelectedList(t){JSON.stringify(this.selectedList)!==JSON.stringify(t)&&this.$emit("selected-changed",[...t])},onInputFocus(){this.chipsInputActive=!0},onInputBlur(){this.chipsInputActive=!1,this.input&&document.activeElement.id!==this.internalId&&(this.input="")},checkKeyEvent(t){const{key:e}=t;["Tab","Enter","Shift"].includes(e)||(this.chipsInputActive=!0),e==="Tab"&&this.input&&(!this.clearable||t.shiftKey&&t.target.tagName==="INPUT"||this.clearable&&!t.shiftKey&&t.target.tagName!=="INPUT")&&(this.input="")},onEnter(){this.closeDropdownOnOptionSelect&&!this.chipsInputActive||this.activeOption&&this.addSelectedOption(this.activeOption)},onArrowKey(t){this.listInt.length&&(this.activeOption=this.navigate(this.listInt,t.key==="ArrowDown",this.activeOptionIndex,!0))},hoverBoxActive(t,e){this.$emit("hoverbox-active",{value:t,entry:e})},calcDropDownMinWidth(){const t=this.$refs.baseInput;t&&t.$el&&t.$el.clientWidth&&(this.dropDownMinWidth=`${t.$el.clientWidth}px`)},closeDropDown(){this.closeDropdownOnOptionSelect&&this.chipsInputActive&&(this.chipsInputActive=!1,this.inputElem&&this.inputElem.blur())},highlight(t){return s.highlightText({word:t,queryString:this.input,...this.highlightTags})}}};var f=function(){var e=this,n=e._self._c;return n("div",{ref:"chipsInput",staticClass:"base-chips-input"},[n("BaseChipsInputField",e._g(e._b({ref:"baseInput",attrs:{"input-type":e.inputType,"add-selected-entry-directly":!1,"selected-list":e.selectedListInt,"drop-down-list-id":e.internalId,"linked-list-option":e.activeOption?e.activeOption[e.identifierPropertyName]:null,"is-active":e.chipsInputActive,loadable:e.allowDynamicDropDownEntries},on:{"update:selectedList":function(i){e.selectedListInt=i},"update:selected-list":function(i){e.selectedListInt=i},"update:isActive":function(i){e.chipsInputActive=i},"update:is-active":function(i){e.chipsInputActive=i},keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.preventDefault(),e.onEnter.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"up",38,i.key,["Up","ArrowUp"])&&e._k(i.keyCode,"down",40,i.key,["Down","ArrowDown"])?null:(i.preventDefault(),e.onArrowKey.apply(null,arguments))},e.checkKeyEvent],"click-input-field":e.onInputFocus,"clicked-outside":e.onInputBlur},scopedSlots:e._u([{key:"below-input",fn:function(){return[e.chipsInputActive?n("BaseDropDownList",{ref:"dropDownList",staticClass:"base-chips-input__drop-down",style:{"min-width":e.dropDownMinWidth},attrs:{"drop-down-options":e.listInt,"active-option":e.activeOption,"selected-option":e.selectedOption,"identifier-property-name":e.identifierPropertyName,"label-property-name":e.labelPropertyName,"list-id":e.internalId,language:e.language,"drop-down-no-options-info":e.dropDownNoOptionsInfo},on:{"update:activeOption":function(i){e.activeOption=i},"update:active-option":function(i){e.activeOption=i},"update:selectedOption":function(i){e.selectedOption=i},"update:selected-option":function(i){e.selectedOption=i}},nativeOn:{click:function(i){return i.stopPropagation(),e.closeDropDown.apply(null,arguments)},touchstart:function(i){return i.stopPropagation(),e.closeDropDown.apply(null,arguments)}},scopedSlots:e._u([{key:"option",fn:function({option:i}){return[e.allowUnknownEntries&&i[e.identifierPropertyName]==="createNew"?n("span",{key:i[e.labelPropertyName],ref:"option"},[e._v(" "+e._s(e.addNewChipText?`${e.addNewChipText} ${e.getLangLabel(i[e.labelPropertyName],!0)} ...`:`${e.getI18nTerm("form.Add",-1,{value:e.getLangLabel(i[e.labelPropertyName],!0)})} ...`)+" ")]):i?[e._t("drop-down-entry",function(){return[i[e.identifierPropertyName]?n("span",{directives:[{name:"insert-text-as-html",rawName:"v-insert-text-as-html",value:{value:e.highlightStringMatch?e.highlight(e.getLangLabel(i[e.labelPropertyName],!0)):e.getLangLabel(i[e.labelPropertyName],!0),interpretTextAsHtml:e.interpretChipsLabelAsHtml},expression:`{
                  value: highlightStringMatch
                    ? highlight(getLangLabel(option[labelPropertyName], true))
                    : getLangLabel(option[labelPropertyName], true),
                  interpretTextAsHtml: interpretChipsLabelAsHtml,
                }`}],key:i[e.identifierPropertyName]}):e._e()]},{item:i})]:e._e()]}},{key:"no-options",fn:function(){return[e._t("no-options")]},proxy:!0}],null,!0)}):e._e(),e._t("below-input")]},proxy:!0},{key:"label-addition",fn:function(){return[e._t("label-addition")]},proxy:!0},{key:"pre-input-field",fn:function(){return[e._t("pre-input-field")]},proxy:!0},{key:"input-field-addition-before",fn:function(){return[e._t("input-field-addition-before")]},proxy:!0},{key:"input-field-inline-before",fn:function(){return[e._t("input-field-inline-before")]},proxy:!0},{key:"input-field-addition-after",fn:function(){return[e._t("input-field-addition-after")]},proxy:!0},{key:"post-input-field",fn:function(){return[e._t("post-input-field"),e.allowMultipleEntries?e._e():n("div",{staticClass:"base-chips-input__single-dropdown",on:{keydown:function(i){if(!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter"))return null;i.stopPropagation(),e.chipsInputActive=!e.chipsInputActive},click:function(i){i.stopPropagation(),e.chipsInputActive=!e.chipsInputActive}}},[n("BaseIcon",{class:["base-chips-input__single-dropdown-icon",{"base-chips-input__single-dropdown-icon-rotated":e.chipsInputActive}],attrs:{name:"drop-down"}})],1)]},proxy:!0},{key:"error-icon",fn:function(){return[e._t("error-icon")]},proxy:!0},{key:"remove-icon",fn:function(){return[e._t("remove-icon")]},proxy:!0}],null,!0),model:{value:e.input,callback:function(i){e.input=i},expression:"input"}},"BaseChipsInputField",e.chipsFieldInputProps,!1),e.$listeners))],1)},y=[],g=c.default(h,f,y,!1,null,"418781d7",null,null);const m=g.exports;exports.default=m;
//# sourceMappingURL=BaseChipsInput.vue.cjs.js.map
