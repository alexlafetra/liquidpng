"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vuedraggable"),r=require("../../utils/utils.cjs.js"),o=require("../BaseInput/BaseInput.vue.cjs.js"),d=require("vue"),u=require("../../composables/useAnnouncer.cjs.js"),p=require("../../mixins/i18n.cjs.js"),c=require("../../mixins/navigateList.cjs.js");require("./BaseChipsInputField.vue.cjs2.js");const h=require("../../_virtual/_plugin-vue2_normalizer.cjs.js"),f={name:"BaseChipsInputField",components:{BaseInput:o.default,BaseChip:()=>Promise.resolve().then(()=>require("../BaseChip/BaseChip.vue.cjs.js")).then(t=>t.default||t),Draggable:a},mixins:[p.default,c.default],model:{prop:"input",event:"input"},props:{id:{type:String,default:""},selectedList:{type:Array,default:()=>[]},input:{type:String,default:""},inputType:{type:String,default:"text",validator:t=>["text","search"].includes(t)},label:{type:String,required:!0},showLabel:{type:Boolean,default:!0},placeholder:{type:String,default:null},allowUnknownEntries:{type:Boolean,default:!0},allowMultipleEntries:{type:Boolean,default:!0},addSelectedEntryDirectly:{type:Boolean,default:!1},sortable:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},alwaysLinked:{type:Boolean,default:!1},hoverboxContent:{type:Object,default:()=>({})},isLoading:{type:Boolean,default:!1},sortText:{type:String,default:"Sort A – Z"},sortName:{type:Boolean,default:!1},language:{type:String,default:""},showInputBorder:{type:Boolean,default:!0},useFormFieldStyling:{type:Boolean,default:!0},dropDownListId:{type:String,default:""},linkedListOption:{type:[Number,String],default:null},identifierPropertyName:{type:String,default:""},labelPropertyName:{type:String,default:"label"},isStringArray:{type:Boolean,default:!1},displayChipsInline:{type:Boolean,default:!0},required:{type:Boolean,default:!1},invalid:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},errorMessage:{type:String,default:""},showErrorIcon:{type:Boolean,default:!0},clearable:{type:Boolean,default:!1},loadable:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},inputClass:{type:String,default:""},setFocusOnActive:{type:Boolean,default:!0},chipsEditable:{type:Boolean,default:!1},assistiveText:{type:Object,default:()=>({selectedOption:"",loaderActive:"loading.",optionAdded:"option {label} added to selected list.",optionToRemoveSelected:"option {label} from selected list marked for removal. Press delete or backspace to remove.",optionRemoved:"option {label} removed."})},chipsRemovable:{type:Boolean,default:!0},interpretChipsLabelAsHtml:{type:Boolean,default:!1}},setup(){const t=d.ref(null),{announcement:e}=u.useAnnouncer(t);return{chipsInputField:t,announcement:e}},data(){return{selectedListInt:[],isActiveInt:!1,timeout:null,fired:!1,drag:!1,indexActiveForRemove:-1,inputInt:""}},computed:{internalId(){return this.id||r.createId()},inputListeners(){return{...this.$listeners,"update:is-active":()=>{}}}},watch:{selectedList:{handler(t){if(t){const e=t.map(n=>({...this.isStringArray?{[this.labelPropertyName]:n}:n,idInt:n[this.identifierPropertyName]||this.getIdInt(n)}));JSON.stringify(e)!==JSON.stringify(this.selectedListInt)&&(this.selectedListInt=e)}else this.selectedListInt=[]},deep:!0,immediate:!0},isActiveInt(t){this.$emit("update:is-active",t)},isActive:{handler(t){t!==this.isActiveInt&&(this.isActiveInt=t)},immediate:!0},input:{handler(t){t!==this.inputInt&&(this.inputInt=t)},immediate:!0},inputInt:{handler(t){t!==this.input&&this.$emit("input",t)},immediate:!0}},methods:{checkKeyEvent(t){const{key:e}=t;if((e==="Tab"&&!(this.clearable&&this.inputInt)||e==="Enter"&&!this.allowMultipleEntries)&&(this.isActiveInt=!1),this.chipsRemovable&&(e==="Backspace"||e==="Delete"))e==="Backspace"&&!this.fired&&!this.inputInt&&this.indexActiveForRemove<0?this.indexActiveForRemove=this.selectedListInt.length-1:this.indexActiveForRemove>=0&&!this.fired&&!this.inputInt&&(this.removeEntry(this.selectedListInt[this.indexActiveForRemove],this.indexActiveForRemove),this.indexActiveForRemove=-1),this.fired=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(()=>{this.fired=!1},200);else if(!this.inputInt&&(t.key==="ArrowRight"||t.key==="ArrowLeft")){const n=t.key==="ArrowRight",i=this.navigate(this.selectedListInt,n,this.indexActiveForRemove,!0);this.indexActiveForRemove=this.selectedListInt.indexOf(i)}else this.indexActiveForRemove=-1;this.indexActiveForRemove>=0&&(this.announcement=this.assistiveText.optionToRemoveSelected.replace("{label}",this.selectedListInt[this.indexActiveForRemove][this.labelPropertyName]))},removeEntry(t,e){const n=this.selectedListInt[e][this.labelPropertyName];this.selectedListInt.splice(e,1),this.updateParentList(this.selectedListInt),this.$emit("removed",t);const i=this.$refs.baseInput.$el.getElementsByTagName("input"),s=Array.from(i).find(l=>l.id===this.internalId);s&&s.click(),setTimeout(()=>{this.announcement=this.assistiveText.optionRemoved.replace("{label}",n)},1e3)},addOption(){if(this.inputInt&&this.allowUnknownEntries&&this.addSelectedEntryDirectly){const t=this.selectedListInt.find(e=>e[this.labelPropertyName]===this.inputInt);if(t)this.$emit("duplicate",t);else{const e=this.allowMultipleEntries?this.selectedListInt.length:0,n={idInt:this.getIdInt(),[this.labelPropertyName]:this.inputInt};this.$set(this.selectedListInt,e,n),this.updateParentList(this.selectedListInt),this.announcement=this.assistiveText.optionAdded.replace("{label}",this.inputInt)}this.inputInt=""}},modifyListEntry(t,e){typeof this.selectedListInt[e][this.labelPropertyName]=="object"&&this.selectedListInt[e][this.labelPropertyName][this.language]!==void 0?this.selectedListInt[e]={[this.labelPropertyName]:{[this.language]:t}}:typeof this.selectedListInt[e][this.labelPropertyName]=="string"&&(this.selectedListInt[e]={[this.labelPropertyName]:t}),this.updateParentList(this.selectedListInt)},updateParentList(t){let e=JSON.parse(JSON.stringify(t));this.isStringArray?e=e.map(n=>n[this.labelPropertyName]):t.length&&(e=e.map(n=>(this.$delete(n,"idInt"),n))),this.$emit("update:selected-list",e)},getIdInt(t=null){if(t){const e=this.selectedListInt.find(n=>n[this.labelPropertyName]===t[this.labelPropertyName]||n[this.labelPropertyName]===t);if(e)return e.idInt}return r.createId()},sortSelectedList(){this.isActiveInt=!1,r.sort(this.selectedListInt,this.labelPropertyName,this.sortName,this.language?this.getLangLabel:null),this.updateParentList(this.selectedListInt)},setDragElement(t,e){const n=e.cloneNode(!0);n.id="chip-inline-drag",n.style.position="absolute",n.style.top="-99999px",n.style.left="-99999px",document.body.appendChild(n),t.setDragImage(n,0,0)},onDragEnd(){this.drag=!1;const t=document.getElementById("chip-inline-drag");t&&t.parentNode.removeChild(t),JSON.stringify(this.selectedList)!==JSON.stringify(this.selectedListInt)&&this.updateParentList(this.selectedListInt)},hoverBoxActive(t,e){this.$emit("hoverbox-active",{value:t,option:e})}}};var m=function(){var e=this,n=e._self._c;return n("div",{ref:"chipsInputField",staticClass:"base-chips-input-field"},[n("BaseInput",e._g({ref:"baseInput",attrs:{id:e.internalId,"field-type":e.inputType,placeholder:e.allowMultipleEntries||!e.selectedListInt.length?e.placeholder:"",label:e.label,"show-label":e.showLabel,"show-input-border":e.showInputBorder,"is-active":e.isActiveInt,"use-form-field-styling":e.useFormFieldStyling,"drop-down-list-id":e.dropDownListId,"linked-list-option":e.linkedListOption,"hide-input-field":!e.allowMultipleEntries&&!!e.selectedListInt.length,invalid:e.invalid,required:e.required,disabled:e.disabled,clearable:e.clearable,loadable:e.loadable,"error-message":e.errorMessage,"show-error-icon":e.showErrorIcon,"is-loading":e.isLoading,"input-class":e.inputClass,"set-focus-on-active":e.setFocusOnActive,"assistive-text":{loaderActive:e.assistiveText.loaderActive}},on:{"update:isActive":function(i){e.isActiveInt=i},"update:is-active":function(i){e.isActiveInt=i},keydown:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.preventDefault(),e.addOption.apply(null,arguments))},e.checkKeyEvent]},scopedSlots:e._u([{key:"label-addition",fn:function(){return[e._t("label-addition"),e.sortable?n("button",{staticClass:"base-chips-input-field__sort",attrs:{"aria-label":`${e.label}. ${e.sortText.replace(/[—–-]/,"to")}`,type:"button"},on:{click:function(i){return e.sortSelectedList(e.selectedListInt)}}},[e._v(" "+e._s(e.sortText)+" ")]):e._e()]},proxy:!0},{key:"pre-input-field",fn:function(){return[e._t("pre-input-field")]},proxy:!0},{key:"input-field-addition-before",fn:function(){return[e._t("input-field-addition-before"),e.displayChipsInline?n("div",{staticClass:"base-chips-input-field__chips"},[e.draggable&&!e.chipsEditable?[n("draggable",{attrs:{"set-data":e.setDragElement,"force-fallback":!0,animation:200,handle:".base-chip__text"},on:{start:function(i){e.drag=!0},end:e.onDragEnd},model:{value:e.selectedListInt,callback:function(i){e.selectedListInt=i},expression:"selectedListInt"}},[n("transition-group",{staticClass:"base-chips-input-field__chips-transition",attrs:{name:e.drag?null:"flip-list",type:"transition"}},[e._l(e.selectedListInt,function(i,s){return[e._t("chip",function(){return[n("BaseChip",{key:e.allowMultipleEntries?"chip-"+i.idInt:s,attrs:{id:i.idInt,entry:e.getLangLabel(i[e.labelPropertyName],!0),"hover-box-content":e.hoverboxContent,"is-linked":e.alwaysLinked||i[e.identifierPropertyName]===0||!!i[e.identifierPropertyName],"chip-active":e.indexActiveForRemove===s,"is-removable":e.chipsRemovable,"interpret-text-as-html":e.interpretChipsLabelAsHtml&&!!i[e.identifierPropertyName]},on:{"remove-entry":function(l){return e.removeEntry(i,s)},"hoverbox-active":function(l){return e.hoverBoxActive(l,i)}}})]},null,{entry:i,index:s,indexActiveForRemove:e.indexActiveForRemove,removeEntry:e.removeEntry})]})],2)],1)]:[e._l(e.selectedListInt,function(i,s){return[e._t("chip",function(){return[n("BaseChip",{key:e.allowMultipleEntries?"chip-"+i.idInt:s,attrs:{id:i.idInt,entry:e.getLangLabel(i[e.labelPropertyName],!0),"hover-box-content":e.hoverboxContent,editable:e.chipsEditable,"is-linked":e.alwaysLinked||i[e.identifierPropertyName]===0||!!i[e.identifierPropertyName],"chip-active":e.indexActiveForRemove===s,"assistive-text":e.assistiveText.selectedOption,"is-removable":e.chipsRemovable,"interpret-text-as-html":e.interpretChipsLabelAsHtml&&!!i[e.identifierPropertyName]},on:{"remove-entry":function(l){return e.removeEntry(i,s)},"value-changed":function(l){return e.modifyListEntry(l,s)},"hoverbox-active":function(l){return e.hoverBoxActive(l,i)}}})]},null,{entry:i,index:s,indexActiveForRemove:e.indexActiveForRemove,removeEntry:e.removeEntry})]})]],2):e._e()]},proxy:!0},{key:"input-field-inline-before",fn:function(){return[e._t("input-field-inline-before")]},proxy:!0},{key:"input-field-addition-after",fn:function(){return[e._t("input-field-addition-after")]},proxy:!0},{key:"post-input-field",fn:function(){return[e._t("post-input-field")]},proxy:!0},{key:"error-icon",fn:function(){return[e._t("error-icon")]},proxy:!0},{key:"remove-icon",fn:function(){return[e._t("remove-icon")]},proxy:!0},{key:"below-input",fn:function(){return[e._t("below-input")]},proxy:!0}],null,!0),model:{value:e.inputInt,callback:function(i){e.inputInt=i},expression:"inputInt"}},e.inputListeners))],1)},y=[],v=h.default(f,m,y,!1,null,"77085512",null,null);const b=v.exports;exports.default=b;
//# sourceMappingURL=BaseChipsInputField.vue.cjs.js.map
