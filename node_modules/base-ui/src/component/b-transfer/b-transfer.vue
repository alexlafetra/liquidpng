<!-- @author mengpeng -->
<!-- @email pengmeng@yangqianguan.com -->
<!-- @date 2019-11-19 17:28:27.858 -->
<!-- @desc generated by yqg-cli@1.0.9 -->

<template>

    <div class="b-transfer">
        <transfer-panel
            :title="title[0]"
            :data="leftData"
            :label-key="labelKey"
            :is-all-selected="isAllSelected[0]"
            :placeholder="placeholder[0]"
            :filter-method="filterMethod[0]"
            :is-query-method="isQueryMethod[0]"
            position="left"
            filterable
            @selected-change="leftChanged"
            @search="search(arguments,'left')"/>
        <div class="b-transfer__buttons">
            <b-button theme="primary" @click="addToLeft">
                <i class="b-icon-left"></i>
                <span v-if="buttonTexts[0] !== undefined">{{ buttonTexts[0] }}</span>
            </b-button>
            <b-button theme="primary" @click="addToRight">
                <i class="b-icon-right"></i>
                <span v-if="buttonTexts[1] !== undefined">{{ buttonTexts[1] }}</span>
            </b-button>
            <slot name="extraButton"></slot>
        </div>
        <transfer-panel
            :title="title[1]"
            :data="rightData"
            :label-key="labelKey"
            :is-all-selected="isAllSelected[1]"
            :placeholder="placeholder[1]"
            :filter-method="filterMethod[1]"
            :is-query-method="isQueryMethod[1]"
            position="right"
            filterable
            @selected-change="rightChanged"
            @search="search(arguments,'right')"/>
    </div>

</template>

<script type="text/babel">
import {remove} from '../../util/array';

import TransferPanel from './b-transfer-panel.vue';

export default {
    name: 'BTransfer',

    components: {
        TransferPanel
    },

    props: {
        title: {
            type: Array,
            default: () => (['列表 1', '列表 2'])
        },

        buttonTexts: {
            type: Array,
            default: () => ([])
        },

        labelKey: {
            type: String,
            default: 'field'
        },

        leftData: {
            type: Array,
            default: () => ([])
        },

        rightData: {
            type: Array,
            default: () => ([])
        },

        isAllSelected: {
            type: Array,
            default: () => ([false, false])
        },

        placeholder: {
            type: Array,
            default: () => (['', ''])
        },

        filterMethod: {
            type: Array,
            default: () => [null, null]
        },

        isQueryMethod: {
            type: Array,
            default: () => [false, false]
        },

        transferMethod: {
            type: Array,
            default: () => ([null, null])
        }

    },

    data() {
        return {
            leftSelected: [],
            rightSelected: []
        };
    },

    computed: {
        name() {
            return this.data;
        }
    },

    provide() {
        return {
            bTransfer: this
        };
    },

    methods: {
        search(args, flag) {
            const vm = this;
            vm.$emit(`${flag}-search`, args[0]);
        },

        addToLeft() {
            const vm = this;
            const {leftData, rightData, rightSelected, transferMethod} = vm;
            if (transferMethod[0]) {
                transferMethod[0]();
            } else {
                leftData.push(...rightSelected);
                rightSelected.forEach(item => remove(rightData, item));
                vm.rightSelected = [];
            }
        },

        addToRight() {
            const vm = this;
            const {leftData, rightData, leftSelected, transferMethod} = vm;
            if (transferMethod[1]) {
                transferMethod[1]();
            } else {
                rightData.push(...leftSelected);
                leftSelected.forEach(item => remove(leftData, item));
                vm.leftSelected = [];
            }
        },

        leftChanged(item, selected) {
            const vm = this;
            vm.leftSelected = selected;
            vm.$emit('left-selected', {item, selected});
        },

        rightChanged(item, selected) {
            const vm = this;
            vm.rightSelected = selected;
            vm.$emit('right-selected', {item, selected});
        }
    }
};
</script>
